# 도메인 주도 개발 시작하기

이 글은 [도메인 주도 개발 시작하기: DDD 핵심 개념 정리부터 구현까지](https://product.kyobobook.co.kr/detail/S000001810495) 책을 읽고 정리한 내용이다.

아래 내용은 책에서 중요한/기억하고자하는 내용 위주로 정리했다. 자세한 내용은 책을 참고하자.


---

## 5장 스프링 데이터 JPA를 이용한 조회 기능

### 5.5 스펙 조합

스펙 인터페이스는 스펙을 조합할 수 있는 두 메서드(and, or)를 제공한다.

null 여부를 검사할 때는 where() 메서드를 사용하면 된다.

```
Specification<OrderSummary> spec =
Specification .where(createNullableSpec()).and(createOtherSpec());
```

* null이면 아무 조건도 생성하지 않는 스펙 객체를 리턴한다.


### 5.8 스펙 조합을 위한 스펙 빌더 클래스

if 와 각 스펙을 조합하는 코드가 섞여 실수를 유발하고 복잡한 구조를 갖는다. 

이러한 점을 보완하기 위해 조건에 따라 스펙을 조합해야 하는 경우 `스펙 빌더`를 만들어 사용한다.

별도의 스팩 빌더 클래스를 추가한 뒤, 해당 메서드를 사용해서 조건을 표현하고 메서드 호출 체인으로 구현하면,

연속된 변수 할당을 줄여 코드 가독성을 높이고 구조를 단순하게 만들 수 있다.


## 6. 응용 서비스와 표현 영역

`표현 영역`은 사용자의 요청을 해석해서 응용 서비스 영역에 전달하는 역할이다.

* 주로 URL, 요청 파라미터, 쿠키, 헤더 등을 이용해서 사용자가 실행하고 싶은 기능을 판별하고 그 기능을 제공하는 응용 서비스를 실행한다.

`응용 서비스 영역`은 사용자가 원하는 기능을 수행한 뒤 표현 영역으로 전달하는 역할이다. 아래와 같은 세부 역할을 담당한다.

* 주로 도메인 객체 간의 흐름을 제어한다.

* 새로운 애그리거트를 생성한다.

* 트랜잭션 처리를 담당한다.

### 6.3 응용 서비스의 구현

응용 서비스는 비즈니스 흐름에만 집중하고, 도메인 로직은 도메인 영역에만 구현하여 코드 품질을 유지한다.

응용 서비스의 크기에 대해서 보통 다음과 같이 두 가지 방법 중 한 가지 방식으로 구현한다.

* (전자) 한 응용 서비스 클래스에 회원 도메인의 모든 기능 구현하기

* (후자) 구분되는 기능별로 응용 서비스 클래스를 따로 구현하기

하나의 응용 서비스를 크게 만들면 당장은 편해 보이지만, 코드가 비대해지고 관련 없는 기능들이 섞여 결국 유지보수가 어려워진다.

반면에 기능 단위로 응용 서비스를 작게 여러 개로 나누면 각 클래스의 역할이 명확해지고 코드가 깔끔해져 장기적인 코드 품질 관리에 훨씬 유리하다.

(이 책에서의 저자는  응용 서비스의 크기를 작고 명확하게 유지하는 후자의 방식을 선호한다.)

또한, 응용 서비스를 구현할 때 논쟁이 될 부분이 인터페이스 필요 여부가 있다.

* 구현 클래스가 여러개인 경우 인터페이스를 만들면 좋지만, 반대로 그게 아니라면 굳이 인터페이스를 사용할 필요는 없다.

* 과거에는 테스트 용이성을 위해 인터페이스를 만들기도 했지만, 최근에는 Mockito와 같은 테스트 도구 덕분에 클래스만으로 테스트가 가능해져 인터페이스의 필요성이 줄어들었다.

### 6.5 값 검증

표현 영역과 응용 서비스는 다음과 같이 역할을 나누어 검증을 수행할 수 있다.

* 표현 영역: 값, 값의 형식, 범위 등을 검증한다.

* 응용 서비스: 데이터의 존재 유무와 같은 논리적 오류를 검증한다.


---

## Review

* 5장과 6장은 도메인 주도 설계에서 나오는 개념을 다루는 내용 보다는 Spring Data JPA 기술과 레이어드 아키텍처에서 좋은 설계에 대한 간단한 예시를 알려주는 내용이었다.

# 도메인 주도 개발 시작하기

이 글은 [도메인 주도 개발 시작하기: DDD 핵심 개념 정리부터 구현까지](https://product.kyobobook.co.kr/detail/S000001810495) 책을 읽고 정리한 내용이다.

아래 내용은 책에서 중요한/기억하고자하는 내용 위주로 정리했다. 자세한 내용은 책을 참고하자.


---

## 9장. 도메인 모델과 바운디드 컨텍스트

한 개의 모델로 모든 하위 도메인 모델을 표현하려는 시도는 올바른 방법이 아니며 표현할 수 없다.

* 예를 들어, 상품, 카탈로그, 재고 -> 각 모델별로 다른 모델을 보는 시각이 다르기 때문에, 하위 도메인에 따라 다른 용어와 의미를 사용한다.

같은 제품이라도 서로 의미가 다르기 때문에, 이렇게 구분되는 경계를 갖는 컨텍스트를 도메인 주도 설계 에서는 `바운디드 컨텍스트`라고 부른다.


### 9.2 바운디드 컨텍스트

바운디드 컨텍스트는 모델의 경계를 결정하며, 한 개의 바운디드 컨텍스트는 논리적으로 한 개의 모델을 갖는다. 용어를 기준으로 구분한다.

이상적으로 하위 도메인과 바운디드 컨텍스트가 일대일 관계를 가지면 좋지만, 현실은 그렇지 않은 경우가 많다.

아래 그림 9.2와 같이 바운디드 컨택스트는 기업의 팀 조직 구조(규모)에 따라 결정되기도 한다.

![](/book/Starting-with-Domain-Driven-Design/img/Starting-with-Domain-Driven-Design-9-1.png)

만약 규모가 작은 조직 또는 기업이라면 아래 그림 9.3과 같이 여러 하위 도메인을 한 개의 바운디드 컨텍스트에서 구현할 수도 있다.

![](/book/Starting-with-Domain-Driven-Design/img/Starting-with-Domain-Driven-Design-9-2.png)

이런 경우에는 하위 도메인마다 구분되는 패키지를 갖도록 구현해서 하위 도메인을 위한 모델이 서로 뒤섞이지 않도록 하는 것이 중요하다.


### 9.3 바운디드 컨텍스트 구현

모든 바운디드 컨텍스트를 반드시 도메인 주도로 개발할 필요는 없다.

도메인 기능 자체가 단순하면 서비스 - DAO 로 구성된 CRUD 방식으로 사용해도 유지보수하는데 문제가 되지 않는다고 생각한다.

하나의 바운디드 컨텍스트에서 두 방식을 혼합해서 사용할 수 있는데, 대표적인 예시가 CQRS 패턴이다.

명령 기능과 내용을 조회하는 쿼리 기능을 위한 모델을 구분하는 패턴으로, 아래 그림 9.7과 같이 상태 변경과 관련된 기능은 도메인 모델 기반으록 ㅜ현하고, 조회 기능은 서비스-DAO를 이용해서 구현할 수 있다.

![](/book/Starting-with-Domain-Driven-Design/img/Starting-with-Domain-Driven-Design-9-3.png)


### 9.4 바운디드 컨텍스트 통합

(1) REST API를 이용한 직접 통합은 한 컨텍스트가 다른 쪽을 즉시 호출하고 응답을 받는 방식으로, 

  호출하는 쪽에서 외부 모델을 자신의 도메인 모델로 변환하는 책임을 진다.

반면, (2) 메시지 큐를 이용한 간접 통합은 한쪽이 메시지를 발행하고 다른 쪽이 구독하는 비동기 방식으로,

  시스템 간의 결합도를 낮춰 장애 전파를 막아준다.

두 방식 모두 외부 데이터를 그대로 사용하지 않고 자신의 모델로 변환하여 **도메인의 경계를 보호**하는 것이 중요하다.


### 9.5 바운디드 컨텍스트 간 관계

바운디드 컨텍스트는 독립적으로 존재하기보다 서로 통합되는 경우가 많으며, 이때 여러 가지 관계를 맺게 된다.

#### 상류 - 하류 관계

가장 흔한 관계는 한쪽이 API를 제공(상류, Upstream)하고 다른 쪽이 그 API를 사용하는(하류, Downstream) 구조이다.

이는 마치 **공급자와 고객의 관계**와 같다.

* `상류 (Upstream)팀`: 서비스 공급자. 다른 팀이 사용할 API를 제공한다. (책의 예시: 추천 시스템)

* `하류 (Downstream)팀`: 서비스 고객. 상류 팀의 API를 호출해서 사용한다. (책의 예시: 카탈로그 시스템)

이 관계에서는 하류 팀이 상류 팀에 의존하므로, 상류 팀이 마음대로 API를 바꾸면 하류 시스템이 망가질 수 있다.

따라서 두 팀 간의 긴밀한 소통과 일정 협의가 필수적이다.

상류 팀이 여러 하류 팀에게 일관된 서비스를 제공할 때, 이를 `공개 호스트 서비스(Open Host Service)` 라고 부른다.

* 대표적인 예시가 `검색`이다.

* 블로그, 카페, 게시판과 같은 서비스를 제공하는 포털은 각 서비스별로 검색 기능을 구현하기 보다는 검색을 위한 전용 시스템을 구축하고 검색 시스템과 각 서비스를 통합한다.

* 이때 검색 시스템이 `상류 컴포넌트`가 되고 블로그, 카페, 게시판은 `하류 컴포넌트`가 된다.

* 상류 팀은 각 하류 컴포넌트의 요구사항을 수용하는 단일 API를 만들어 이를 공개하고, 각 하류 팀은 공개된 API를 사용해서 검색 기능을 구현한다.

![](/book/Starting-with-Domain-Driven-Design/img/Starting-with-Domain-Driven-Design-9-4.png)

#### 안티코럽션 계층

하류 컨텍스트는 상류 컨텍스트의 모델(데이터 형식)이 자신의 도메인 모델을 오염시키는 것을 막아야 한다.

이때 사용하는 것이 **`안티코럽션 계층(ACL)`** 이다.

이 계층은 하류 컨텍스트의 인프라스트럭쳐 영역에 위치하며, 다음과 같은 역할을 수행한다.

* 상류 시스템의 API를 호출한다.

* 상류 시스템의 데이터 모델을 하류 시스템의 도메인 모델로 변환한다.

아래 그림 9.19 처럼 ResSystemClient 는 외부 시스템과의 연동을 처리하는데 외부 시스템의 도메인 모델이 내 도메인 모델을 침범하지 않도록 막아주는 역할을 한다.

![](/book/Starting-with-Domain-Driven-Design/img/Starting-with-Domain-Driven-Design-9-5.png)

이러한 계층 덕분에 하류 컨텍스트는 외부의 변화에 영향을 받지 않고 자신의 모델 순수성을 지킬 수 있다.

---

## Review

* 도메인 주도 설계의 주요 개념 중 하나인 `바운디드 컨텍스트`에 대한 개념과 실무에서 어떻게 적용해야할 지 간단한 예시를 통해 이해는 했지만, 완전히 이해는 못했다.

* 하지만 해당 개념을 녹여서 실무에 적용해본다면, 코드간의 경계를 구분짓는데 용이해질것이라 생각한다.

* 또한, 컨텍스트를 통합할 때 모델간의 순수성을 지키기 위해 ACL을 사용하는 방법에 대해서도 알아봤다.

* 이 장을 통해 팀, 비즈니스, 아키텍처 수준에서 시스템을 바라보는 시각을 이전보다 더 넓게 갖게 된 것 같다.
